# otusNoSql
## CAP  теорема
1. MSSQL - CA, как и прочие реляционные БД плохо переносит разделение системы. Зато данные согласованы и доступны. 
2. Cassandra - чаще всего описывается как AP система, т.е. жертвующая согласованностью ради доступности. Р с нами всегда, поскольку при выпадении одной из нод Cassandra продолжает работу. По умолчанию, копии данных пишутся на разные ноды и если какая-то нода выпадает/недоступна, наступает момент когда реплики имеют различные данные, т.е. приходим к AP. Но, как и для Mongo, есть нюансы. Кассандра поддерживает настраиваемую согласованность, когда перед чтением/записью клиент указывает уровень согласованности. Если указать уровень QUORUM(максимальный) для чтения, то мы плавно приходим к СP, и клиент получает только самые последние данные(если все ноды живы). Аналог есть и для записи, когда указывается количество всех существующих реплик, чтобы поддержать С в CP. Естественно, если реплика лежит, то никакой записи не произойдет и так мы теряем А в CAP. А вот если указать QUORUM для чтения и записи - то есть вероятность превращения в P систему, в случае недоступности хотя бы одной из нод. По итогу Cassandra - это AP, но ее можно принудительно заставить вести себя как СР. 
3. MongoDB - P также как и у Cassandra будет всегда, и по тем же причинам. По умолчанию MongoDB можно назвать СР системой, но это ее поведение по умолчанию.  В отличии от Cassandra имеет мастер ноду и "сателиты", данные по умолчанию пишутся/читаются в мастер, потом сателиты получают реплики. Так, казалось бы получаем букву С(без А потому что если мастер недоступен, мы ничего не получим) и приходим к СР. Но, чтение может быть перенаправлено на реплики(или мастер умер и мы выбираем новго мастера из реплик) и так мы приходим от СР к СА(по тем же причинам что и у Cassandra, реплика недодоступна, данные несогласуются, часть данных из мастера не попало в реплику, пока мастер был жив, а мы пробуем из реплики/нового мастера читать). Также как и Cassandra MongoDB имеет настраиваемую согласованность, которая можетт даже при чтении из реплик поспособствовать нужному уровню согласованности и вернуть нам CP, но и вернуть риск получить просто Р, если постараемся получить согласованность и на запись и на чтение. Как итог - танцы между СР и СА, но с уклоном больше в СР 
